<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--主要I是强制让文档的宽度与设备宽度保持1:1，最大宽度1.0，禁止屏幕缩放。-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <!--这个也是iphone私有标签，允许全屏浏览。-->
    <meta content="yes" name="apple-mobile-web-app-capable">
    <!--iphone的私有标签，iphone顶端状态条的样式。-->
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!--禁止数字自动识别为电话号码，这个比较有用，因为一串数字在iphone上会显示成蓝色，样式加成别的颜色也是不生效的。-->
    <meta content="telephone=no" name="format-detection">
    <!--禁止email识别-->
    <meta content="email=no" name="format-detection">
    <meta content="initial-dpr=2" name="flexible"/>
    <title>Title</title>
    <link rel="stylesheet" href="../css/muse-ui.css">
    <link rel="stylesheet" href="../css/material-icons.css">
    <!--<link rel="stylesheet" href="../css/video-js.css">-->
    <script src="../js/flexible.debug.js"></script>
    <script src="../js/flexible_css.debug.js"></script>
    <!--<script src="../js/video.js"></script>-->
    <style lang="less" type="text/less">
        html {
            -webkit-text-size-adjust: none;
            height: 100%;
            touch-action: pan-y;
        }
        #wrapper {
            width: 100%;
            font-family: MicrosoftYaHei;
            color:#999999;
            .video{
                position: fixed;
                top: 0;
                left: 0;
                height: 13.2rem;
                z-index: -1000;
                width: 100%;
                -webkit-overflow-scrolling: touch;
                .video-wrapper{
                    width: 100%;
                    height: 13rem;
                    text-align: center;
                    video{
                        width: 100%;
                    }
                    #output {
                        position: absolute;
                        top:0;
                        left:0;
                        width: 100%;
                        height: 13rem;
                        text-align: center;
                        img{
                            position: absolute;
                            top:50%;
                            left: 50%;
                            transform: translate3d(-50%,-50%,0);
                            z-index: 100;
                            width: 100%;
                            height: auto;
                        }
                    }
                    .control{
                        position: absolute;
                        bottom: 0rem;
                        left: 0;
                        background-color: #999999;
                        width: 100%;
                        height: 1rem;
                        div{
                            display: flex;
                            justify-content: space-between;
                            height: 100%;
                            width: 100%;
                        }
                        .pause{
                            align-self: center;
                            margin-left: 0.3rem;
                            width: 0.3rem;
                            span{
                                margin-left: 0.05rem;
                                border-left: 0.1rem solid #fff;
                            }
                        }
                        .play{
                            align-self: center;
                            margin-left: 0.3rem;
                            width: 0.3rem;
                            div{
                                border: 0.2rem solid transparent;
                                border-left: 0.25rem solid #fff;
                            }
                        }
                        .progress{
                            align-self: center;
                            position: relative;
                            width: 50%;
                            height: 25%;
                            border-radius: 0.1rem;
                            background: rgba(0,0,0,.6);
                            .bar{
                                position: absolute;
                                top:0;
                                left:0;
                                width: 0;
                                height: 100%;
                                background-color:#F7F5F5;
                                border-radius: 0.1rem;
                            }
                        }
                        .times{
                            align-self: center;
                            color: white;
                            margin-right: 0.3rem;
                        }
                        .full{
                            align-self: center;
                            color: white;
                            margin-right: 0.3rem;
                        }
                    }
                }
            }
            .contain{
                width: 100%;
                float:left;
                border-top-left-radius:0.33rem;
                border-top-right-radius:0.33rem;
                -webkit-background-clip: padding-box;
                background-clip: padding-box;
                background: #fff;
                .user_info{
                    padding: 0.8rem 0.61rem;
                    div{
                        display: flex;
                        justify-content: space-between;
                    }
                    ul{
                        display: flex;
                        li{
                            margin-top: 0.34rem;
                            padding:0.13rem 0.53rem;
                            margin-right: 0.26rem;
                            font-size: 0.4rem;
                            border-radius: 0.08rem;
                            background:rgba(245,246,250,1);
                        }
                    }
                }
                .main{
                    padding: 0.8rem 0.61rem;
                    span{
                        color:#484848;
                        font-family: PingFang-SC-Bold;
                        font-size: 0.45rem;
                    }
                    p{
                        margin-top: 0.66rem;
                        color:#6B6B6B;
                        font-size: 0.37rem;
                        line-height:0.68rem;
                    }
                }
            }
            .mu-carousel{
            position:relative;
            width:100%;
            height:100%;
            .mu-carousel-item{
                position:absolute;
                top:50%;
                left:50%;
                transform:translate(-50%,-50%);
                width:90%;
                height:90%;
                img{
                    position:absolute;
                    top:50%;
                    left:50%;
                    transform:translate(-50%,-50%);
                    width:90%;
                }
            }
        }
        }
        .demo-loadmore-wrap {
            width: 100%;
            display: flex;
            flex-direction: column;
            box-shadow:0 0 0 0 white;
            .demo-loadmore-content {
                flex: 1;
                -webkit-overflow-scrolling: touch;
            }
        }
        .line {
            border-bottom: 1px solid #E6E6E6
        }
         .dialog-open {
            -webkit-overflow-scrolling:touch;
            position: fixed;
            width: 100%;
        }
    </style>
</head>
<body style="background: no-repeat;">
<div id="wrapper" style="visibility:hidden">
    <div class="video">
        <div class="video-wrapper">
            <div id="output" v-show="play" @click="videoPlay">
                <img src="../images/pofang@2x.png" alt="" style="width: 2rem;">
            </div>
            <video id="video" preload="auto" x5-video-player-type="h5" v-if="this.detail.video" :poster="this.detail.video.cover">
                <source :src="this.detail.video.file_path" type="video/mp4">
            </video>
            <div class="control">
                <div>
                    <span class="pause" v-show="!play" @click="videoPause($event)"><span></span><span></span></span>
                    <span class="play" v-show="play" @click="videoPlay"><div></div></span>
                    <span class="progress" @click="drop($event)">
                        <span class="bar" v-show="!play || pause"></span>
                    </span>
                    <span class="times">
                        <span class="current">00:00:00</span>/
                        <span class="totalTime">00:00:00</span>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="contain" id="contain">
        <div class="user_info">
            <div>
                <span style="font-size: 0.53rem;color:#484848;font-family: PingFang-SC-Heavy;"><span v-if="this.detail.user" style="margin-right: 0.32rem;">{{this.detail.user.nickname}}</span><img v-show="level>0" id="level" v-for="item in level" :src="level1" style="width: 0.4rem;margin-top: 0.1rem;margin-right:0.02rem"></span>
                <span style="color:#3BC7FF;font-size: 0.42rem" v-if="this.detail.city">{{this.detail.city.city_name}}</span>
            </div>
            <ul>
                <li v-for="item in this.detail.industry">{{item.name}}</li>
            </ul>
        </div>
        <div class="line" style="margin: 0 0.53rem;"></div>
        <div class="main">
            <span>工作描述</span>
            <p>
                {{this.detail.description}}
            </p>
        </div>
        <div class="line" style="margin: 0 0.53rem;"></div>
        <div class="main">
            <span>图片作品</span>
            <ul style="width: 100%;margin-top: 0.66rem;">
                <li style="display: inline-block;width: 2.8rem;height:2.8rem;line-height:2.8rem;overflow:hidden;background:#000;text-align:center;margin-right: 0.12rem;" v-for="(item,index) in this.detail.images"><img :src="item.file_path" alt="" style="width:100%;vertical-align:middle;" @click="openSimpleDialog(index)"></li>
            </ul>
        </div>
        <div class="line" style="margin: 0 0.53rem;"></div>
        <div class="main">
            <span>接单记录</span>
            <mu-paper :z-depth="1" class="demo-loadmore-wrap">
                <mu-container ref="container" class="demo-loadmore-content">
                    <mu-load-more :loading="loading" @load="load" :loaded-all="over" :loading-text="text">
                        <div v-for="(item,index) in record.data" style="font-family: PingFang-SC-Medium">
                            <div style="width: 100%;margin-top: 0.8rem;margin-bottom: 0.37rem;display: flex;justify-content: space-between;">
                                <div style="width: 0.88rem;height:0.88rem;overflow:hidden"><img :src="item.company.logo_path" alt="" width="100%" height="100%" style="border-radius: 50%"></div>
                                <div style="width:6rem;margin-left: 0.34rem">
                                    <span style="font-size: 0.4rem;color: #333333">{{item.company.company_name}}</span>
                                    <p style="font-size: 0.32rem;margin-top: 0.29rem">任务：{{item.task.task_title}}</p>
                                </div>
                                <p style="color:#3BC7FF;font-size: 0.42rem;margin-top: 0">{{item.reputation}}.0分</p>
                            </div>
                            <p style="margin-left: 1.3rem;color:#333333;font-size: 0.37rem;line-height: 0.56rem;margin-bottom: 0.8rem;">
                                {{item.description}}
                            </p>
                            <div class="line"></div>
                        </div>
                    </mu-load-more>
                </mu-container>
            </mu-paper>
            <div style="height: 1rem"><br/></div>
        </div>
    </div>
    <div style="position: fixed;top:0;left:0;background:#000;width: 100%;height: 100%;z-index:1000;text-align:center" v-if="openSimple" @click="close">
        <mu-carousel hide-indicators hide-controls interval=6000 :active="bigImg">
            <mu-carousel-item v-for="(item,index) in this.detail.images">
                <img :src="item.file_path">
            </mu-carousel-item>
        </mu-carousel>
    </div>
</div>
</body>
<script src="../js/vue.js"></script>
<script src="../js/axios.min.js"></script>
<script src="../js/muse-ui.js"></script>
<script src="../js/less.min.js"></script>
<script>
    var vue = new Vue({
        el: '#wrapper',
        data: {
            detail:{},
            record:{},
            loading: false,
            initialize: false,
            play:true,
            pause:false,
            token:'',
            page:1,
            over:false,
            text:'正在加载',
            level:0,
            level1:"../images/x.png",
            level2:"../images/z.png",
            level3:"../images/mission3@2x.png",
            level4:"../images/mission@2x.png",
            // q:true,
            openSimple: false,
            bigImg: null,
        },
        mounted() {
            if(this.detail){
                this.initialize = true;
            }
            ModalHelper = ((bodyCls) => {
                let scrollTop;
                return {
                    afterOpen: function () {
                        scrollTop = document.scrollingElement.scrollTop;
                        document.body.classList.add(bodyCls);
                        document.body.style.top = -scrollTop + 'px';
                    },
                    beforeClose: function () {
                        document.body.classList.remove(bodyCls);
                        document.scrollingElement.scrollTop = scrollTop;
                    },
                };
            })('dialog-open');
        },
        methods:{
            load() {
                if(this.detail){
                    this.loading = true;
                    this.page = this.page + 1;
                    if(this.detail.user.user_id){
                        axios.get('http://produce.jmzhipin.com/api/task/comment/paginate?user_id=' + this.detail.user.user_id + '&page=' + this.page, {
                            headers: {
                                'x-access-sign': '585c84aca67b58e000364309783e31e6',
                                'Authorization': this.token,
                            }
                        })
                            .then(function (res) {
                                if(res.data.last_page < this.page){
                                    this.text = '已加载全部！';
                                    setTimeout(() => {
                                        this.over = true;
                                    }, 1500);
                                }else{
                                    var length = res.data.data.length;
                                    for(var i = 0;i<length; i++){
                                        this.record.data.push(res.data.data[i])
                                    }
                                    this.page = res.data.current_page;
                                    setTimeout(() => {
                                        this.loading = false;
                                    }, 1000);
                                    console.log(this.record);
                                }
                                if(res.data.data.length < 1){
                                    this.text = '已加载全部！';
                                    setTimeout(() => {
                                        this.over = true;
                                    }, 1500);
                                }
                                if(res.data.code !== 200){
                                    setTimeout(() => {
                                        this.over = true;
                                    }, 1500);
                                }
                            }.bind(this))
                            .catch(function (error) {
                                console.log(error);
                            });
                    }
                    setTimeout(() => {
                        this.text = '已加载全部！';
                        this.loading = false;
                    }, 1500);
                }

            },
            videoPause(e){
                var video = document.getElementById('video');
                video.pause();
                var pValue = (video.currentTime/video.duration)*100;
                var bar = document.getElementsByClassName('bar')[0];
                bar.style.width = pValue+"%";
                //显示当前播放进度的时间
                document.querySelector(".current").innerText = this.getTimeBySecond(video.currentTime);
                this.play = true;
                this.pause = true
            },
            videoPlay(){
                var video = document.getElementById('video');
                video.play();
                setInterval(function () {
                    var pValue = (video.currentTime/video.duration)*100;
                    var bar = document.getElementsByClassName('bar')[0];
                    bar.style.width = pValue+"%";
                    //显示当前播放进度的时间
                    document.querySelector(".current").innerText = this.getTimeBySecond(video.currentTime);
                }.bind(this));
                this.play = false;

            },
            drop(e){
                var video = document.getElementById('video');
                var progress = document.getElementsByClassName('progress')[0];
                this.pause = true;
                var bar = document.getElementsByClassName('bar')[0];
                bar.style.width = e.offsetX + "px";
                var time = video.duration / progress.clientWidth * e.offsetX;
                video.currentTime = time;
                console.log(video.currentTime);
                console.log(time);
                document.querySelector(".current").innerText = this.getTimeBySecond(time);
            },
            getTimeBySecond(second){
                var hour = parseInt(second / (60* 60));
                var minute = parseInt((second/60) % 60);
                var second = parseInt(second % 60);
                return (hour < 10 ? "0" + hour:hour) + ":" + (minute < 10 ? "0" + minute:minute) + ":" + (second < 10 ? "0" + second:second);
            },
            handleRecord(){
            if(this.detail.user.user_id){
                axios.get('http://produce.jmzhipin.com/api/task/comment/paginate?user_id=' + this.detail.user.user_id, {
                    headers: {
                        'x-access-sign': '585c84aca67b58e000364309783e31e6',
                        'Authorization': this.token,
                    }
                })
                    .then(function (res) {
                        var jsonData = JSON.stringify(res.data);
                        this.record = JSON.parse(jsonData);
                        this.page = this.record.current_page;
                        console.log(jsonData)
                        console.log(this.token)
                    }.bind(this))
                    .catch(function (error) {
                        console.log(error);
                    });
                }
            },
            leveling(){
                var img = document.getElementById('level');
                console.log(img)
                if(this.detail.user.reputation){
                    if(4 <= this.detail.user.reputation && this.detail.user.reputation <= 10){
                        this.level = 1;
                        img.src = this.level1
                    }
                    if(11 <= this.detail.user.reputation && this.detail.user.reputation <= 40){
                        this.level = 2;
                        img.src = this.level1
                    }
                    if(41 <= this.detail.user.reputation && this.detail.user.reputation <= 90){
                        this.level = 3;
                        img.src = this.level1
                    }
                    if(91 <= this.detail.user.reputation && this.detail.user.reputation <= 150){
                        this.level = 4;
                        img.src = this.level1
                    }
                    if(151 <= this.detail.user.reputation && this.detail.user.reputation <= 250){
                        this.level = 5;
                        img.src = this.level1
                    }
                    if(251 <= this.detail.user.reputation && this.detail.user.reputation <= 500){
                        this.level = 1;
                        img.src = this.level2
                    }
                    if(501 <= this.detail.user.reputation && this.detail.user.reputation <= 1000){
                        this.level = 2;
                        img.src = this.level2
                    }
                    if(1001 <= this.detail.user.reputation && this.detail.user.reputation <= 2000){
                        this.level = 3;
                        img.src = this.level2
                    }
                    if(2001 <= this.detail.user.reputation && this.detail.user.reputation <= 5000){
                        this.level = 4;
                        img.src = this.level2
                    }
                    if(5001 <= this.detail.user.reputation && this.detail.user.reputation <= 10000){
                        this.level = 5;
                        img.src = this.level2
                    }
                    if(10001 <= this.detail.user.reputation && this.detail.user.reputation <= 20000){
                        this.level = 1;
                        img.src = this.level3
                    }
                    if(20001 <= this.detail.user.reputation && this.detail.user.reputation <= 50000){
                        this.level = 2;
                        img.src = this.level3
                    }
                    if(50001 <= this.detail.user.reputation && this.detail.user.reputation <= 100000){
                        this.level = 3;
                        img.src = this.level3
                    }
                    if(100001 <= this.detail.user.reputation && this.detail.user.reputation <= 200000){
                        this.level = 4;
                        img.src = this.level3
                    }
                    if(200001 <= this.detail.user.reputation && this.detail.user.reputation <= 500000){
                        this.level = 5;
                        img.src = this.level3
                    }
                    if(500001 <= this.detail.user.reputation && this.detail.user.reputation <= 1000000){
                        this.level = 1;
                        img.src = this.level4
                    }
                    if(1000001 <= this.detail.user.reputation && this.detail.user.reputation <= 2000000){
                        this.level = 2;
                        img.src = this.level4
                    }
                    if(2000001 <= this.detail.user.reputation && this.detail.user.reputation <= 5000000){
                        this.level = 3;
                        img.src = this.level4
                    }
                    if(5000001 <= this.detail.user.reputation && this.detail.user.reputation <= 10000000){
                        this.level = 4;
                        img.src = this.level4
                    }
                    if(this.detail.user.reputation > 1000000){
                        this.level = 5;
                        img.src = this.level4
                    }
                }
            },
            openSimpleDialog (index) {
                this.openSimple = true;
                this.bigImg = index;
                ModalHelper.afterOpen();
            },
             close(){
                this.openSimple = false;
                ModalHelper.beforeClose()
            }
        },
        watch:{
            detail(){
                this.$nextTick(function(){
                    document.getElementById('wrapper').style.visibility = 'visible';
                    var videoWrap = document.getElementById('contain');
                    if(vue.detail.video){
                        videoWrap.style.marginTop = '13rem';
                        var video = document.getElementById('video');
                        video.addEventListener("ended",function(){
                            document.getElementsByClassName('bar')[0].style.width = '0';
                            video.currentTime = 0;
                            vue.play = true;
                        });
                        video.addEventListener("durationchange",function(){
                            document.getElementsByClassName("totalTime")[0].innerText = vue.getTimeBySecond(video.duration);
                            console.log(video.duration)
                        });
                        video.addEventListener("pause",function(){
                            vue.play = true;
                        });
                    }else{
                        videoWrap.style.marginTop = '-0.3rem';
                    }
                    vue.leveling();
                });
            },
        }
    });
    function showInfoFromJava(item,token) {
        vue.detail = JSON.parse(item);
        vue.token = token;
        vue.handleRecord();
    };
    /*if(vue.detail){
        function taskDataLoading(){
            Javascript:aaa.taskDataLoading()
        }
        this.taskDataLoading();

    };*/
</script>
</html>